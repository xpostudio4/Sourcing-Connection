<!doctype html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">

        <title>{% block title %}Home{% endblock %}</title>
        <link rel="stylesheet" href="{{ STATIC_URL }}css/jqueryui.css" type="text/css" />
        <link rel="stylesheet" href="{{ STATIC_URL }}css/jquery.tagit.css" type="text/css" />
        <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/jquery-ui.min.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/tagit.min.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/bootstrap/bootstrap.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/bootstrap/bootstrap.min.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/mustache.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/tag-it.js"></script>
        <link rel="stylesheet" href="{{ STATIC_URL }}css/jquery.tagit.css" type="text/css" />
        <link rel="stylesheet" href="{{ STATIC_URL }}css/style.css" type="text/css" />
        <link rel="stylesheet" href="{{ STATIC_URL }}css/bootstrap/bootstrap.min.css" type="text/css" />
        <link rel="stylesheet" href="{{ STATIC_URL }}css/bootstrap/bootstrap-responsive.min.css" type="text/css" />
        <script src="{{STATIC_URL}}js/modernizr.min.js" type="text/javascript" charset="utf-8"></script>
        <script>  $(document).ready(function(){
            $('input, textarea, select').addClass('input-large'); 
            $('.p').after('<br>');
            $('.helptext').remove();
            //Activate the dropdown menu capabilities
            $('.dropdown-toggle').dropdown();
            $('#myModal').modal({
              backdrop: 'static',
              keyboard: true
            });

       });</script> 
        {% block external %}{% endblock %}
    </head>
    <body>
        <div class="container">

            
    <ul class="nav nav-pills pull-right" style="margin-right: 15%;">
        <li class="dropdown all-camera-dropdown">
            {% if user.is_authenticated %}
                <div>
                {% if user.is_superuser %}
                    <a href="/admin">Admin</a> | 
                {% endif %}
                <a href="/logout">Logout</a>

                    
                </div>

        {% else %}
            <a class="dropdown-toggle dropdown-signin" data-toggle="dropdown" href="#">
                Sign in<span class="caret"></span>
            </a>
            <ul class="dropdown-menu" data-html="true">
                <div>
                <form style="width: 250px; margin: 5%;">
                    <label for "username" >Username</label>
                    <input class="input-large" type="text" name="username" autocomplete="on">
                    <label for "password" >Password</label>
                    <input class="input-large" type="password" value="" name="password">
                    <fieldset class="subchck">
                        <label class="remember">
                            <input type="checkbox" value="1" name="remember_me" checked="checked">
                            <span>Remember me</span>
                        </label>
                        <button type="submit" class="btn submit">Sign in</button>
                    </fieldset>
                </form>
                </div>
            </ul>
        
        {% endif %}
        </li>

    </ul>

    <br style="height: 5px;"/>

    <a href="#" class="pull-right btn btn-success" id="signup" style="clear: both;margin-right: 15%;"><small>no account? </small>Sign Up!</a>
    <br/>
    <div class="masthead">
        <h3 class="muted">Logo Here</h3>


        <div class="navbar">
            <div class="navbar-inner">
                <div class="container">
                    <ul class="nav">
                        <li class="active">
                            <a href="/">Home</a>
                        </li>
                        <li>
                            <a href="/profile/{{ user.id }}">Profile</a>
                        </li>
                        <li>
                            <a href="#">Messages</a>
                        </li>
<!--                    <li><a href="/company/new">CREATE COMPANY</a> </li> -->
                        <li><a class="mbttn" href="#company-name-modal">New Company</a>
                        <li><a href="/news/new">New Post</a> </li>
                        <li>
                            <a id="csearch" class="dropdown-toggle dropdown-signin" data-html="true" data-toggle="popover" data-placement="bottom" data-content='<form>
                <label for="company_name">
                    Company Name
                </label>
                <input type="text" class="input-medium" placeholder="Company Name">

                <div class="accordion" id="accordion2" style="width: 165px;">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
                                Industry
                            </a>
                        </div>
                        <div id="collapseOne" class="accordion-body collapse in">
                            <div class="accordion-inner">
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Biotech
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Life Sciences
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Big Data
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Financial Services
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo">
                                Category
                            </a>
                        </div>
                        <div id="collapseTwo" class="accordion-body collapse">
                            <div class="accordion-inner">
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Category 1
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Category 2
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Category 3
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Category 4
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion3" href="#collapseThree">
                                Country
                            </a>
                        </div>
                        <div id="collapseThree" class="accordion-body collapse">
                            <div class="accordion-inner">
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    United States
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Mexico
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Colombia
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Nicaragua
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Venezuela
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Peru
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Bolivia
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Chile
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Costa Rica
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion3" href="#collapseFour">
                                Technologies
                            </a>
                        </div>
                        <div id="collapseFour" class="accordion-body collapse">
                            <div class="accordion-inner">
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Django
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Flask
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Ruby on Rails
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    Sinatra
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion3" href="#collapseFour">
                                Status
                            </a>
                        </div>
                        <div id="collapseFour" class="accordion-body collapse">
                            <div class="accordion-inner">
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    GTB-1
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    GTB-2
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    GTB-3
                                </label>
                                <label class="checkbox">
                                    <input type="checkbox"></input>
                                    GTB-4
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <a class="btn btn-success">Search</a>
            </form>' href="#">Company Search</a>

                        </li>

                    <!-- Read about Bootstrap dropdowns at http://twitter.github.com/bootstrap/javascript.html#dropdowns -->
                    {% if user.is_authenticated %}
        
                    
                    <li><a href="/profile/{{ user.id }}">Hi, {{ user.username }}</a></li>
                    <li><a href="/password/change/">Change Password</a></li>
                    {% endif %} 
                    <li>
                      <form class="navbar-form pull-right">
                        <input type="text" class="span2">
                        <button type="submit" class="btn">Search</button>
                     </form>
                    </li>
                  

                    </ul>
                  </ul>
                </div><!--/.nav-collapse -->
              </div><!-- /.navbar-inner -->
            
        <!--- Modal Form -->
       <!--- Modal Form -->
       {% if user.is_authenticated %}

       {% else %}
        <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-header">
            
            <h3 id="myModalLabel">Login</h3>
          </div>
          <div class="modal-body">
            <p>Sign in with Your Globaltech User.</p>
            <form method="POST" action="/login/" >
              {% csrf_token %}
              {{ user_form.as_p}}
              <input type="submit" class="btn btn" value="Sign In" />
            </form>
          </div>
          <div class="modal-footer">
          </div>
        </div>

        {% endif %}
                        
                    </div>
                </div>
            </div>
        
        {% block header %}{% endblock %}
 
   <div id="body">
        {% block content %}{% endblock %}
    </div>
    </div>
<div id="company-name-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="CompanyLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="CompanyLabel">Creating a New Company</h3>
  </div>
  <div class="modal-body">
      <form method="POST" id="name-form" action="/companies/name/">{% csrf_token %} 
        <input type="text" id="name" name="name" placeholder="Company Name">
      </form>
      <div id="results"></div>
      <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        <a href="#" id="save-company" class="hide"><button class="btn btn-primary">Save Company</button></a>
        {% if user.contact.latech_contact or user.is_staff or user.is_superuser %}
             <a href="#" id="view-company-page" class="hide"><button class="btn">Edit Company</button></a>
        {% else %}
            <a href="#" id="webmaster" class="hide"><button class="btn btn-danger">Contact Webmaster</button></a>

        {% endif%}
        
      </div>
      <!--{% include "webmaster_form.html" %}-->
      <form method="POST" action="/contact/" id="wm_contact" class="hide">{% csrf_token %} 
        <div><input type="text" id="contact_name" name="name" placeholder="Email"></div>
        <div><input type="text" id="msg_title" name="msg_title" placeholder="Title"></div>
        <div><textarea id="msg_content" name="msg_content" rows="5"> </textarea></div>
        <div class="modal-footer">
          <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
          <a href="#" id="webmaster" <button class="btn btn-danger">Contact Webmaster</button></a>
        </div>
      </form>
</div>
</div>

<!-- Modal -->
<div id="wm_contact2" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="WebmasterLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="WebmasterLabel">Contact to WebMasters</h3>
  </div>
  <div class="modal-body">
      <form method="POST" action="/webmaster/">{% csrf_token %} 
        <div><input type="text" id="contact_name" name="name" placeholder="Email"></div>
        <div><input type="text" id="msg_title" name="msg_title" placeholder="Title"></div>
        <div><textarea id="msg_content" name="msg_content" rows="5"> </textarea></div>
        <div class="modal-footer">
          <button class="btn" data-dismiss="modal" id="close-modal" aria-hidden="true">Close</button>
          <a href="#" id="webmaster2" <button class="btn btn-danger">Contact Webmaster</button></a>
        </div>
      </form>

  </div>
</div>

<script type="text/javascript">
        $('.dropdown-toggle').dropdown();
        $('.tooltipa').tooltip();
        $('#csearch').popover();
var slug = function(str) {
  str = str.replace(/^\s+|\s+$/g, ''); // trim
  str = str.toLowerCase();

  // remove accents, swap ñ for n, etc
  var from = "ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;";
  var to   = "aaaaaeeeeeiiiiooooouuuunc------";
  for (var i=0, l=from.length ; i<l ; i++) {
    str = str.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i));
  }

  str = str.replace(/[^a-z0-9 -]/g, '') // remove invalid chars
    .replace(/\s+/g, '-') // collapse whitespace and replace by -
    .replace(/-+/g, '-'); // collapse dashes

  return str;
};

    $('a.mbttn').click(function(e) {
            e.preventDefault();
            $('#name-form').trigger('reset');
            $(".alert-success").addClass('hide');
            $(".alert-error").addClass('hide');
            $("#webmaster").addClass('hide');
            $("#save-company").addClass('hide');
            $("#view-company-page").addClass("hide");
            $('#company-name-modal').modal({
                show: true, 
                backdrop: 'static',
                keyboard: true
             })
    });

      var webmaster_contact = $('#webmaster');
          webmaster_contact.click( 
          function(event){
            $('#wm_contact').removeClass('hide');
            var co_name = $('#name');
            event.preventDefault();
/*            $.ajax({
                url: "/companies/name/",
                type: "POST",
                cache: false,
                data:  co_name, 

                success: 
                    $("#wm_contact").modal("hide")
                    ,
                error: 
                    function(xhr){
                        alert("Error: " + xhr.statusText);
                        //alert("We are experiencing problems with the server , please try again later");
                        return false;
                    }
            });
*/        })

    $(function () {
        var name = $('#name');
        var alerts = $('#alerts')
        name.keyup(function() {
           $.ajax({
           type: "post",
           timeout: 5000,
           url: "/ssss/",
           data: { 
            'name' : name.val(),
            'csrfmiddlewaretoken': '{{csrf_token}}', },
           dataType: "json",
           async: 'true',
           cache: false,
           success: 
                function(data){ 
//             alert( "Se guardaron los datos: " + data);

//            results = $(data).find('#results').html();
            $("#results").html("<span>" + data + "</span>");
            if ($('div').hasClass('alert alert-success'))
                {
                    $("#save-company").removeClass("hide"); 
                    $("#webmaster").addClass("hide");
                    $("#wm_contact").addClass("hide");
                    $("#view-company-page").addClass("hide");
                }else if ($('div').hasClass('alert alert-error')){
                    $("#save-company").addClass("hide"); 
                    $("#webmaster").removeClass("hide");
                    var url="/company/"+slug(name.val())+"/";
                    $("#view-company-page").removeClass("hide");
                    $("#view-company-page").html('<a href='+url+' id="view-company-page"><button class="btn">View this company</button></a>');

                }
            

            },
           error:function(xhr) {
               alert("error in getting from server: " + xhr.responseText);
           },
        });

        })
    })  

        var save_company = $('#save-company');
        save_company.click( 
        function(event){

            var company_name = $('#name');
            url_name = "/company/"+slug(company_name.val());
            event.preventDefault();
            $.ajax({
                url: "/companies/name/",
                type: "POST",
                dataType: 'json',
                data: { 
                  'name' : company_name.val(),
                  'csrfmiddlewaretoken': '{{csrf_token}}', 
                },
                cache: false,
                success: 

                    window.location.replace(url_name),
                  
                error: 
                    function(xhr){
                        alert("Error: " + xhr.statusText);
                        return false;
                    }
            });
        });
    

    var close_modal = $("#close-modal");

    close_modal.click(
        function(event){
            event.preventDefault();
            $("#company-name-modal").modal("hide");
        });


</script>


    </body>
</html>
